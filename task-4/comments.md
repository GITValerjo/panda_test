
Одно из очевидных решений это разделение результатов работы запроса на порции и обработки частями.

Проблемы:

Проблема 1:
Изменение данных во время обработки: Если данные в таблице изменяются (например, добавляются новые строки), это может привести к пропуску или повторной обработке строк.
Решение: 
Зафиксировать состояние таблицы с помощью SELECT ... FOR UPDATE, но это залочит ее для обновления может аффектить на другие процессы.
Альтернативно, создать временную таблицу/снимок данных (например, с помощью CREATE TABLE AS SELECT)

Тут для полноценного решения необходимо анализировать саму таблицу в БД и ее использование.

Проблема 2:
Производительность: Если таблица очень большая, запросы могут быть медленными. 
Решение:
Убедиться, что поле id индексировано.

Проблема 3:
Память: 
Если порция данных слишком большая, это может привести к превышению доступной памяти.
Решение:
Уменьшить размер порции ($batch_size).


